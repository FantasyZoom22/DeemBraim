<!DOCTYPE html>
<html>
<head>
  <title>Deem2Braim</title>
  <script src="https://apis.google.com/js/api.js"></script>
  <style>
  body {
    text-align: center;
}

button, select {
    margin: 10px;
}

#tableContainer {
    margin: 20px;
    padding: 10px;
    border: 1px solid #ccc;
}

  </style>
</head>
<body>
    <button id="connectButton">Connect to Google Sheets</button>
    <select id="spreadsheetSelector"></select>
        <select id="sheetSelector"></select>
    <div id="tableContainer"></div>
    
    <script>
let spreadsheetId;
let sheetId;

function loadSheetsAPI() {
    gapi.load('client', initSheetsAPI);
}

function initSheetsAPI() {
    gapi.client.init({
        apiKey: 'AIzaSyAYsVQoSUpYDulbshcq7sqJXgCpMvYb4nM',
        discoveryDocs: ['https://sheets.googleapis.com/$discovery/rest?version=v4'],
    }).then(function () {
        // API is initialized, you can now use gapi.client.sheets

        // Fetch a list of spreadsheets and populate the dropdown
        gapi.client.sheets.spreadsheets
            .list()
            .then(function (response) {
                const spreadsheets = response.result.files;
                const spreadsheetSelector = document.getElementById('spreadsheetSelector');
                spreadsheetSelector.style.display = 'block';

                spreadsheets.forEach((spreadsheet) => {
                    const option = document.createElement('option');
                    option.value = spreadsheet.id;
                    option.text = spreadsheet.name;
                    spreadsheetSelector.appendChild(option);
                });

                // Event listener for spreadsheet selection
                spreadsheetSelector.addEventListener('change', displaySpreadsheet);
            });
    });
}

function displaySpreadsheet() {
    spreadsheetId = document.getElementById('spreadsheetSelector').value; // Get the selected spreadsheet ID
    sheetId = null; // Reset the sheet ID

    // Fetch data from the selected spreadsheet and populate the sheet dropdown
    gapi.client.sheets.spreadsheets.get({
        spreadsheetId: spreadsheetId,
    }).then(function (response) {
        const sheets = response.result.sheets;
        const sheetSelector = document.getElementById('sheetSelector');
        sheetSelector.style.display = 'block';
        sheetSelector.innerHTML = '';

        sheets.forEach((sheet) => {
            const option = document.createElement('option');
            option.value = sheet.properties.title;
            option.text = sheet.properties.title;
            sheetSelector.appendChild(option);
        });

        // Event listener for sheet selection
        sheetSelector.addEventListener('change', displaySelectedSheet);
    });
}

function displaySelectedSheet() {
    sheetId = document.getElementById('sheetSelector').value; // Get the selected sheet name

    // Fetch data from the selected sheet and populate the editable table
    gapi.client.sheets.spreadsheets.values.get({
        spreadsheetId: spreadsheetId,
        range: sheetId + '!A1:Z100', // Adjust the range as needed
    }).then(function (response) {
        const values = response.result.values;

        // Create an editable table and populate it with the data
        const tableContainer = document.getElementById('tableContainer');
        const table = document.createElement('table');

        values.forEach((row) => {
            const tr = document.createElement('tr');
            row.forEach((cell) => {
                const td = document.createElement('td');
                td.contentEditable = true;
                td.textContent = cell;
                tr.appendChild(td);
            });
            table.appendChild(tr);
        });

        tableContainer.innerHTML = '';
        tableContainer.appendChild(table);
    });
}

// Automatically load spreadsheets and sheets when the page loads
window.addEventListener('load', loadSheetsAPI);

    </script>
</body>
</html>
